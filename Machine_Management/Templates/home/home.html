{% extends 'home/layout_home.html' %}

{% block css %}
{% load static %}
<!--&lt;!&ndash; Font Awesome &ndash;&gt;-->
<!--<link rel="stylesheet" type="text/css" href="{% static 'iconfont/all.css' %}">-->
<!--&lt;!&ndash; Jquery   &ndash;&gt;-->
<!--<script src="{% static 'javascript/jquery-3.5.1.min.js' %}"></script>-->
<!--&lt;!&ndash; Create Avatar &ndash;&gt;-->
<!--<script src="{% static 'javascript/avatar.js' %}"></script>-->
<!-- Style -->
<link rel="stylesheet" type="text/css" href="{% static 'style/home.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'style/switch.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'style/calendar.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'style/maintenance.css' %}">
{% endblock %}

{% block content %}
<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
  <ol class="carousel-indicators">
    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
  </ol>
</div>
<!-- Style -->
<link rel="stylesheet" type="text/css" href="{% static 'style/home.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'style/calendar.css' %}">
<!-- Content -->
<div class="home-greeting">
    <div class="page-header row no-gutters py-4">
        <div class="col-12 col-sm-4 text-sm-left mb-0">
            <span>Hi {{User_login.firstname}}</span><br>
            </h3><h3 id="Greetings"></h3>
            <span id="today-date"></span>
        </div>
    </div>
</div>
<div class="container home-content">
    <div class="row">
        <div class="col-12 col-xl-4 d-none d-xl-flex flex-column" style="padding-left: 0px;">
            <div class="card" style="margin-bottom: 24px;">
                <div class="card-body py-4">
                    <div class="maintenance-notify">
                        <div class="maintenance-notify-body">
                            <h3 class="mb-2">{{repair_inform_incomplete.count}}</h3>
                            <p class="mb-2">ใบแจ้งซ่อมเครื่องจักร</p>
                            <div class="mb-0">
                                <span class="badge request-badge">กำลังดำเนินการแจ้งซ่อม</span>
                            </div>
                        </div>
                        <div class="d-inline-block ml-3">
                            <div class="stat">
                                <a href="{% url 'repair_notice' %}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16">
                                    <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z"/>
                                    <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                                </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-body py-4">
                    <div class="maintenance-notify">
                        <div class="maintenance-notify-body">
                            <h3 class="mb-2">{{mtn_report_incomplete.count}}</h3>
                            <p class="mb-2">รายการ</p>
                            <div class="mb-0">
                                <span class="badge pending-badge">กำลังดำเนินการซ่อมบำรุง</span>
                            </div>
                        </div>
                        <div class="d-inline-block ml-3">
                            <div class="stat">
                                <a href="{% url 'maintenance_report' %}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-tools" viewBox="0 0 16 16">
                                    <path d="M1 0L0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.356 3.356a1 1 0 0 0 1.414 0l1.586-1.586a1 1 0 0 0 0-1.414l-3.356-3.356a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3c0-.269-.035-.53-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814L1 0zm9.646 10.646a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708zM3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026L3 11z"/>
                                </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-6 col-xl-4 d-flex">
            <div class="card flex-fill w-100 daily-tasks">
                <div class="card-header" style="background-color: #fff; padding-top: 1.25rem;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div><span class="h4"><b>Daily tasks</b></span></div>
                        <div><p class="task-count">({{today_request_tasks.count|add:today_maintenance_tasks.count}})</p></div>
                    </div>
                </div>
                <div class="card-body scrollable-y" style="max-height: 277px;">
                    {% for request in today_request_tasks %}
                    <div class="media">
                        <div class="task-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16">
                                <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z"/>
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                            </svg>
                        </div>
                        <div class="media-body">
                            <strong>{{request.repairer_user.firstname}} {{request.repairer_user.lastname}}</strong> แจ้งซ่อม<strong>{{request.machine.machine_name}}</strong> {{request.machine.line}}
                            {% if request.problem_report %}
                                เนื่องจาก{{request.problem_report}}
                            {% endif %}
                        </div>
                    </div>
                    <hr>
                    {% endfor %}
                    {% for maintenance in today_maintenance_tasks %}
                    {% if maintenance.job_status == 'รอการมอบหมาย' or maintenance.job_status == 'รอการมอบหมายงาน' %}
                    <div class="media">
                        <div class="task-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-plus-fill" viewBox="0 0 16 16">
                                <path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                                <path fill-rule="evenodd" d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                        </div>
                        <div class="media-body">
                            รอการมอบหมายงานซ่อม<strong>{{maintenance.job_mch_sp.spare_part}}</strong> {{maintenance.job_mch_sp.machine.machine_name}} {{maintenance.job_mch_sp.machine.line}}
                        </div>
                    </div>
                    <hr>
                    {% elif maintenance.job_status == 'รอการดำเนินงาน' %}
                    <div class="media">
                        <div class="task-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tools" viewBox="0 0 16 16">
                                <path d="M1 0L0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.356 3.356a1 1 0 0 0 1.414 0l1.586-1.586a1 1 0 0 0 0-1.414l-3.356-3.356a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3c0-.269-.035-.53-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814L1 0zm9.646 10.646a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708zM3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026L3 11z"/>
                            </svg>
                        </div>
                        <div class="media-body">
                            <strong>{{maintenance.job_response_user.firstname}} {{maintenance.job_response_user.lastname}}</strong> กำลังดำเนินการซ่อม{{maintenance.job_mch_sp.machine.machine_name}} {{maintenance.job_mch_sp.machine.line}}
                        </div>
                    </div>
                    <hr>
                    {% elif maintenance.job_status == 'รอการอนุมัติงาน' %}
                    <div class="media">
                        <div class="task-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16">
                                <path d="M8.5 11.5a.5.5 0 0 1-1 0V7.707L6.354 8.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 7.707V11.5z"/>
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                            </svg>
                        </div>
                        <div class="media-body">
                            รออนุมัติผลการซ่อม<strong>{{maintenance.job_mch_sp.spare_part}}</strong> {{maintenance.job_mch_sp.machine.machine_name}} {{maintenance.job_mch_sp.machine.line}}
                        </div>
                    </div>
                    <hr>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-xl-4 d-flex" style="justify-content:flex-end;">
            <div class="card card-calendar">
                <!-- Calendar -->
                <div id="calendar"></div>
            </div>
        </div>
    </div>
</div>

<div class="jobs-header">
    <div class="page-header row no-gutters py-4">
        <div class="col-12 col-sm-4 text-sm-left mb-0">
        <span class="text-uppercase page-subtitle">Overview</span>
        <h3 class="page-title">Maintenance </h3>
        </div>
    </div>
</div>
<div class="jobs-status">
            <div class="row">
                <div class="col-lg-4 px-3">
                    <span class="h5">New Jobs</span>
                    <div class="scroll-area" data-spy="scroll" data-offset="0">

                        <!-- For loop maintenance requests -->
                        {% for repair in repair_receive_all %}
                            <div class="card">
                                <div class="card-hearder request-header d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-2"><b>{{repair.repair_no}}</b></h6>
                                        </div>
                                        <div class="text-right">
                                            <i class="fas fa-ellipsis-h" data-toggle="modal" data-target="#request-setting{{forloop.counter}}"></i>
                                        </div>
                                </div>
                                <div class="card-body request">
                                    <span class="badge request-badge">ใบแจ้งซ่อม</span>
                                    <p class="text-sm text-muted">{{repair.machine.machine_name}}  {{repair.machine.line}}</p>
                                    <span class="card-details">
                                        <i class="far fa-clock"></i> DUE DATE : {{repair.use_date}}
                                    </span>
                                </div>
                            </div>
                            <!-- Modal maintenance requests -->
                            <div id="request-setting{{forloop.counter}}" class="modal fade" tabindex="-1">
                                <div class="modal-dialog modal-xl">
                                    <div class="modal-content">
                                        <form method="POST">
                                            {% csrf_token %}
                                            <div class="modal-header">
                                                <h5 class="modal-title">ใบแจ้งซ่อมเครื่องจักร {{forloop.counter}}</h5>
                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            </div>
                                            <div class="modal-body">
                                                <h5><u><strong>ข้อมูลใบแจ้งซ่อม</strong></u></h5>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <label class="control-label">หมายเลขใบแจ้งซ่อม : {{repair.repair_no}}</label>
                                                        </div>
                                                        <div class="col-md-6" style="text-align: right;">
                                                            <label class="control-label">วันที่แจ้งซ่อม : {{repair.notification_date}}</label>
                                                        </div>
                                                    </div>
                                                <label class="control-label">สถานะใบแจ้งซ่อม : <b><u>{{repair.repair_status}}</u></b></label><br>
                                                <label class="control-label">หน่วยงานทีแจ้งใบแจ้งซ่อมเครื่องจักร : {{repair.department_notifying.department_code}} {{repair.department_notifying.department_name}}</label><br>
                                                <label class="control-label">หน่วยงานทีรับใบแจ้งซ่อมเครื่องจักร : {{repair.department_receive.department_code}} {{repair.department_receive.department_name}}</label><br>
                                                <div class="row">
                                                    <div class="col-2">
                                                        <label class="control-label">พนักงานที่แจ้ง :</label><br>
                                                        <label class="control-label">พนักงานที่ตรวจสอบ :</label><br>
                                                        <label class="control-label">พนักงานที่อนุมัติ :</label><br>
                                                    </div>
                                                    <div class="col-1">
                                                        <label class="control-label">{{repair.repairer_user.username}}</label><br>
                                                        <label class="control-label">{{repair.inspect_user.username}}</label><br>
                                                        <label class="control-label">{{repair.approve_user.username}}</label><br>
                                                    </div>
                                                    <div class="col-2">
                                                        <label class="control-label">{{repair.repairer_user.firstname}}  {{repair.repairer_user.lastname}}</label><br>
                                                        <label class="control-label">{{repair.inspect_user.firstname}}  {{repair.repairer_user.lastname}}</label><br>
                                                        <label class="control-label">{{repair.approve_user.firstname}}  {{repair.repairer_user.lastname}}</label><br>
                                                    </div>
                                                    <div class="col-4">
                                                        <label class="control-label">ที่อยู่อีเมล : {{repair.repairer_user.email}}</label><br>
                                                        <label class="control-label">ที่อยู่อีเมล : {{repair.inspect_user.email}}</label><br>
                                                        <label class="control-label">ที่อยู่อีเมล : {{repair.approve_user.email}}</label><br>
                                                    </div>
                                                </div>
                                                <hr>
                                                <h5><u><strong>เครื่องจักร</strong></u></h5>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label class="control-label">เครื่องจักร : <u>{{repair.machine.machine_production_line_code}} | {{repair.machine.machine_name}}</u>&nbsp;&nbsp;&nbsp; [ {{repair.machine.line}} ]</label><br>
                                                    </div>
                                                    <div class="col-md-6" style="float: right;">
                                                        <label class="control-label">วันที่ต้องการใช้งาน : {{repair.use_date}}</label><br>
                                                    </div>
                                                </div>
                                                <label class="control-label">ปัญหาเครื่องจักรที่พบ : {{repair.problem_report}}</label><br>
                                                <label class="control-label">ผลกระทบของปัญหา : {{repair.effect_problem}}</label><br>
                                                <hr>
                                                <div class="row">
                                                    <div class="col-sm-8">
                                                        <h5><u><strong>อุปกรณ์หรือชิ้นส่วนที่ชำรุด</strong></u><a onclick="morePart(this)" id="more-part{{forloop.counter}}" type="button"><i class="fas fa-plus-circle more-maintenance-part-btn" ></i></a></h5>
                                                    </div>
                                                </div>
                                                <table class="table table-borderless">
                                                    <thead>
                                                        <tr>
                                                            <td style="width: 7%;">ลำดับที่</td>
                                                            <td style="width: 22%;">กลุ่มอะไหล่</td>
                                                            <td style="width: 22%;">ประเภทอะไหล่</td>
                                                            <td style="width: 22%;">ชนิดอะไหล่</td>
                                                            <td style="width: 22%;">อะไหล่</td>
                                                            <td style="width: 4%;"></td>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="add-more-part-table" id="add-more-part-table{{forloop.counter}}">
                                                        <!-- javascript table -->
                                                    </tbody>
                                                </table>
                                                <hr>
                                                <h5><u><strong>วิศวกรที่รับผิดชอบ</strong></u>
                                                <div class="form-group row" style="margin-top: 10px; padding-bottom: 0px;">
                                                    <div class="col-sm-6">
                                                        <label>ค้นหาด้วยรหัสพนักงาน :</label>
                                                        <select  class="selectpicker" data-live-search="true" id="engineer_user{{forloop.counter}}" name="engineer_username" onchange="load_selected_engineer(this)" required="True" data-url="{% url 'load_username' %}">
                                                            <option value="">-- กรุณาเลือกผู้ตรวจสอบ --</option>
                                                            {% for user in engineers %}
                                                            <option value="{{user.pk}}">{{user.pk}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <label>ค้นหาด้วยชื่อพนักงาน :</label>
                                                        <select  class="selectpicker" data-live-search="true" id="engineer_name{{forloop.counter}}" name="engineer_name" onchange="load_selected_engineer(this)" required="True" data-url="{% url 'load_username' %}" >
                                                            <option value="">-- กรุณาเลือกผู้ตรวจสอบ --</option>
                                                            {% for user in engineers %}
                                                            <option value="{{user.pk}}">{{user.firstname}}  {{user.lastname}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <input type="text" class="form-control" name="engineer" id="set_engineer{{forloop.counter}}" value="" readonly/>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-primary" name="mtn_submit" value="{{repair.pk}}">Submit</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}

                        <!-- For loop jobs -->
                        {% for mtn_job in maintenance_job_gen %}
                            {% if mtn_job.job_status == "รอการมอบหมาย" %}
                            <div class="card">
                                <div class="card-hearder request-header d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-2"><b>{{mtn_job.job_no}}</b></h6>
                                        </div>
                                        <div class="text-right">
                                            <i class="fas fa-ellipsis-h" data-toggle="modal" data-target="#round-setting{{forloop.counter}}"></i>
                                        </div>
                                </div>
                                <div class="card-body">
                                    <p class="text-sm text-muted">{{mtn_job.job_mch_sp.spare_part}}</p>
                                    <p class="text-sm text-muted">{{mtn_job.job_mch_sp.machine.machine_name}} {{mtn_job.job_mch_sp.machine.line}}</p>
                                    <span class="card-details">
                                        <i class="far fa-clock"></i> {{mtn_job.job_gen_date}}
                                    </span>
                                </div>
                            </div>
                            {% endif %}
                            <!-- Modal jobs -->
                            <div id="round-setting{{forloop.counter}}" class="modal fade" tabindex="-1">
                                <div class="modal-dialog modal-xl">
                                    <div class="modal-content">
                                        <form method="POST">
                                            {% csrf_token %}
                                            <div class="modal-header">
                                                <h5 class="modal-title">Machine Maintenance Data</h5>
                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="form-group">
                                                    <div class="form-row">
                                                        <div class="col-md-2">
                                                            <label>Line</label>
                                                            <input type="text" id="line_machine{{forloop.counter}}" class="form-control" name="line_machine" value="{{mtn_job.job_mch_sp.machine.line}}" readonly>
                                                        </div>
                                                        <div class="col-md-5">
                                                            <label>Machine</label>
                                                            <input type="text" id="set_machine{{forloop.counter}}" class="form-control" name="set_machine" value="{{mtn_job.job_mch_sp.machine.machine_production_line_code}} | {{mtn_job.job_mch_sp.machine.machine_name}}" readonly>
                                                        </div>
                                                        <div class="col-md-5">
                                                            <label>Spare Part</label>
                                                            <input type="text" id="set_spare_part{{forloop.counter}}" class="form-control" name="set_spare_part" value="{{mtn_job.job_mch_sp.spare_part.spare_part_group}} | {{mtn_job.job_mch_sp.spare_part}}" readonly>
                                                        </div>
                                                    </div>
                                                </div>
                                                <label><strong>การซ่อมบำรุงรักษา</strong></label><hr>
                                                <div class="row">
                                                    <div class="form-group col-4">
                                                        <label>Last Maintenance</label>
                                                        <input type="number" class="form-control" id="last_mtn_change{{forloop.counter}}" name="last_mtn_change" value="{{mtn_job.job_mch_sp.last_mtnchng_hour}}">
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label>Life Maintenance</label>
                                                        <input type="number" class="form-control" id="life_mtn_hour{{forloop.counter}}" name="life_mtn_hour" value="{{mtn_job.job_mch_sp.mtnchng_life_hour}}">
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label>Next Maintenance</label>
                                                        <input type="number" class="form-control" id="next_mtn_change{{forloop.counter}}" name="next_mtn_change" value="{{mtn_job.job_mch_sp.next_mtnchng_hour}}">
                                                    </div>
                                                </div>

                                                <label><strong>การตรวจสอบ</strong></label><hr>
                                                <div class="row">
                                                    <div class="form-group col-4">
                                                        <label>Last Checking</label>
                                                        <input type="number" class="form-control" id="last_mtn_check{{forloop.counter}}" name="last_mtn_check" value="{{mtn_job.job_mch_sp.last_mtnchk_hour}}">
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label>Life Checking</label>
                                                        <input type="number" class="form-control" id="life_check_hour{{forloop.counter}}" name="life_check_hour" value="{{mtn_job.job_mch_sp.mtnchk_life_hour}}">
                                                    </div>
                                                    <div class="form-group col-4">
                                                        <label>Next Checking</label>
                                                        <input type="number" class="form-control" id="next_mtn_check{{forloop.counter}}" name="next_mtn_check" value="{{mtn_job.job_mch_sp.next_mtnchk_hour}}">
                                                    </div>
                                                </div>
                                                <hr>
                                                <h5><u><strong>วิศวกรที่รับผิดชอบ</strong></u>
                                                <div class="form-group row" style="margin-top: 10px; padding-bottom: 0px;">
                                                    <div class="col-sm-6">
                                                        <label>ค้นหาด้วยรหัสพนักงาน :</label>
                                                        <select  class="selectpicker" data-live-search="true" id="round_engineer_user{{forloop.counter}}" name="engineer_username" onchange="load_selected_engineer_round(this)" required="True" data-url="{% url 'load_round_username' %}">
                                                            <option value="">-- กรุณาเลือกผู้ตรวจสอบ --</option>
                                                            {% for user in engineers %}
                                                            <option value="{{user.pk}}">{{user.pk}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <label>ค้นหาด้วยชื่อพนักงาน :</label>
                                                        <select  class="selectpicker" data-live-search="true" id="round_engineer_name{{forloop.counter}}" name="engineer_name" onchange="load_selected_engineer_round(this)" required="True" data-url="{% url 'load_round_username' %}">
                                                            <option value="">-- กรุณาเลือกผู้ตรวจสอบ --</option>
                                                            {% for user in engineers %}
                                                            <option value="{{user.pk}}">{{user.firstname}}  {{user.lastname}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <input type="text" class="form-control" name="engineer" id="set_round_engineer{{forloop.counter}}" value="" readonly/>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-primary" name="set_maintenance_data" value="{{mtn_job.job_mch_sp.pk}}">Submit</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}

                    </div>
                </div>
                <div class="col-lg-4 px-3">
                    <span class="h5">In progress</span>
                    <div class="scroll-area" data-spy="scroll" data-offset="0">
                        <!-- For loop maintenance requests -->
                        {% for mtn_job in maintenance_job_gen %}
                        {% if mtn_job.job_no|first in 'RP' and mtn_job.job_status == 'รอการดำเนินงาน' %}
                        <div class="card">
                            <div class="card-hearder request-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-2"><b>{{mtn_job.job_no}}</b></h6>
                                    </div>
                                    <div class="text-right">
                                        <i class="fas fa-ellipsis-h" data-toggle="modal" data-target="#job{{forloop.counter}}"></i>
                                    </div>
                            </div>
                            <div class="card-body request">
                                {% if mtn_job.repair_notice_set %}
                                {% for repair in mtn_job.repair_notice_set.all %}
                                <span class="badge request-badge">{{repair.repair_no}}</span>
                                {% endfor %}
                                {% endif %}
                                <p class="text-sm text-muted">{{mtn_job.job_mch_sp.spare_part.spare_part_name}}</p>
                                <p class="text-sm text-muted">{{mtn_job.job_mch_sp.machine.machine_name}} {{mtn_job.job_mch_sp.machine.line}}</p>
                                <span class="card-details">
                                    <i class="fas fa-wrench"></i>&nbsp;ENGINEER : {{mtn_job.job_response_user_id}}
                                </span>
                            </div>
                        </div>
                        <!-- For loop jobs -->
                        {% elif mtn_job.job_status == 'รอการดำเนินงาน' %}
                        <div class="card">
                            <div class="card-hearder request-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-2"><b>{{mtn_job.job_no}}</b></h6>
                                    </div>
                                    <div class="text-right">
                                        <i class="fas fa-ellipsis-h" data-toggle="modal" data-target="#job{{forloop.counter}}"></i>
                                    </div>
                            </div>
                            <div class="card-body">
                                <p class="text-sm text-muted">{{mtn_job.job_mch_sp.spare_part.spare_part_name}}</p>
                                <p class="text-sm text-muted">{{mtn_job.job_mch_sp.machine.machine_name}} {{mtn_job.job_mch_sp.machine.line}}</p>
                                <span class="card-details">
                                    <i class="fas fa-wrench"></i>&nbsp;ENGINEER : {{mtn_job.job_response_user_id}}
                                </span>
                            </div>
                        </div>
                        {% endif %}
                        <!-- Modal jobs -->
                        <div id="job{{forloop.counter}}" class="modal fade" tabindex="-1">
                            <div class="modal-dialog modal-xl">
                                <div class="modal-content">
                                    <form method="POST">
                                        {% csrf_token %}
                                        <div class="modal-header">
                                            <h5 class="modal-title">Maintenance Report</h5>
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        </div>
                                        <div class="modal-body">
                                            {% if mtn_job.repair_notice_set %}
                                            {% for repair in mtn_job.repair_notice_set.all %}
                                            <center><h5><u><strong>ข้อมูลใบแจ้งซ่อม</strong></u></h5></center><br>
                                            <div class="form-group row">
                                                <div class="col-5">
                                                    <label>หมายเลขใบแจ้งซ่อมเครื่องจักร</label>
                                                    <input type="text" class="form-control" value="{{repair.repair_no}}" readonly>
                                                </div>
                                                <div class="col-2">
                                                    <label>วันที่แจ้งซ่อมเครื่องจักร</label>
                                                    <input type="text" class="form-control" value="{{repair.notification_date}}" readonly>
                                                </div>
                                                <div class="col-2">
                                                    <label>วันที่ต้องการใช้งาน</label>
                                                    <input type="text" class="form-control" value="{{repair.use_date}}" readonly>
                                                </div>
                                                <div class="col-3">
                                                    <label>สถานะใบแจ้งซ่อมเครื่องจักร</label>
                                                    <input type="text" class="form-control" name="repair_no" value="{{repair.repair_status}}" readonly>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-6">
                                                    <label>ผู้แจ้งใบแจ้งซ่อมเครื่องจักร</label>
                                                    <input type="text" class="form-control" value="{{repair.repairer_user.username}}" readonly>
                                                </div>
                                                <div class="col-6">
                                                    <label>หน่วยงานที่แจ้งซ่อมเครื่องจักร</label>
                                                    <input type="text" class="form-control" value="{{repair.department_notifying.department_code}} {{repair.department_notifying.department_name}}" readonly>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-6">
                                                    <label>ปัญหาเครื่องจักรที่พบ</label>
                                                    <input type="text" class="form-control" value="{{repair.problem_report}}" readonly>
                                                </div>
                                                <div class="col-6">
                                                    <label>ผลกระทบของปัญหาเครื่องจักร</label>
                                                    <input type="text" class="form-control" value="{{repair.effect_problem}}" readonly>
                                                </div>
                                            </div>
                                            <hr>
                                            {% endfor %}
                                            {% endif %}
                                            <center><h5><u><strong>ข้อมูลงาน</strong></u></h5></center><br>
                                            <div class="form-group">
                                                <div class="form-row">
                                                    <div class="col-6">
                                                        <label>หมายเลขงาน</label>
                                                        <input type="text" id="jobNo{{forloop.counter}}" class="form-control" name="job_no" value="{{mtn_job.job_no}}" readonly>
                                                    </div>
                                                    <div class="col-3">
                                                        <label>วันที่สร้างงาน</label>
                                                        <input type="text" id="job_gen_date{{forloop.counter}}" class="form-control" name="job_gen_date" value="{{mtn_job.job_gen_date}}" readonly>
                                                    </div>
                                                    <div class="col-3">
                                                        <label>สถานะงาน</label>
                                                        <input type="text" id="job_status{{forloop.counter}}" class="form-control" name="job_status" value="{{mtn_job.job_status}}" readonly>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="form-row">
                                                    <div class="col-6">
                                                        <label>ผู้มอบหมายงาน</label>
                                                        <input type="text" id="job_assign{{forloop.counter}}" class="form-control" name="job_no" value="{{mtn_job.job_assign_user_id}}" readonly>
                                                    </div>
                                                    <div class="col-6">
                                                        <label>ผู้รับผิดชอบงาน</label>
                                                        <input type="text" id="job_response{{forloop.counter}}" class="form-control" name="job_gen_date" value="{{mtn_job.job_response_user_id}}" readonly>
                                                    </div>
                                                </div>
                                            </div>
                                            <h1>{{mtn_job.repair_notice_set.0.problem_report}}</h1>
                                            <hr><br>
                                            <center><h5><u><strong>ข้อมูลเครื่องจักร</strong></u></h5></center><br>
                                            <div class="form-group">
                                                <div class="form-row">
                                                    <div class="col-md-2">
                                                        <label class="control-label">Line</label>
                                                        <input type="text" id="mch_line{{forloop.counter}}" class="form-control" name="mch_line" value="{{mtn_job.job_mch_sp.machine.line}}" readonly>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <label class="control-label">Machine</label>
                                                        <input type="text" id="machine{{forloop.counter}}" class="form-control" name="machine" value="{{mtn_job.job_mch_sp.machine.machine_production_line_code}} | {{mtn_job.job_mch_sp.machine.machine_name}}" readonly>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <label class="control-label">Spare Part</label>
                                                        <input type="text" id="spare_part{{forloop.counter}}" class="form-control" name="spare_part" value="{{mtn_job.job_mch_sp.spare_part.spare_part_group}} | {{mtn_job.job_mch_sp.spare_part}}" readonly>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr><br>
                                            <center><h5><u><strong>บันทึกผู้ดำเนินการซ่อม</strong></u></h5></center><br>
                                            <div class="form-group">
                                                <label>สาเหตุขัดข้องของเครื่อง</label>
                                                <textarea class="form-control" rows="2" name="problem_cause">{{mtn_job.problem_cause|default_if_none:''}}</textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>วิธีดำเนินการแก้ไข</label>
                                                <textarea class="form-control" rows="2" name="corrective_action">{{mtn_job.corrective_action|default_if_none:''}}</textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>วิธีการทำความสะอาดหลังการซ่อม</label>
                                                <textarea class="form-control" rows="2" name="after_repair">{{mtn_job.after_repair|default_if_none:''}}</textarea>
                                            </div>
                                            <hr size="6"><br>
                                            <center><h5><u><strong>รายการอุปกรณ์ / ชิ้นส่วนในการซ่อม</strong></u></h5></center><br>
                                            <div class="form-group">
                                                <div class="form-row">
                                                    <div class="col-1">
                                                        <label>ลำดับที่</label><br>
                                                        <label class="col-sm-2 col-form-label">1</label><br>
                                                        <label class="col-sm-2 col-form-label">2</label><br>
                                                        <label class="col-sm-2 col-form-label">3</label>
                                                    </div>
                                                    <div class="col-2">
                                                        <label>รหัสอุปกรณ์</label>
                                                        <input type="text" id="equipment_code{{forloop.counter}}" class="form-control" name="equipment_code1" value="{{mtn_job.equipment_code1|default_if_none:''}}">
                                                        <input type="text" id="equipment_code2{{forloop.counter}}" class="form-control" name="equipment_code2" value="{{mtn_job.equipment_code2|default_if_none:''}}">
                                                        <input type="text" id="equipment_code3{{forloop.counter}}" class="form-control" name="equipment_code3" value="{{mtn_job.equipment_code3|default_if_none:''}}">
                                                    </div>
                                                    <div class="col-4">
                                                        <label>อุปกรณ์ที่ใช้ / รุ่น</label>
                                                        <input type="text" id="equipment_detail1{{forloop.counter}}" class="form-control" name="equipment_detail1" value="{{mtn_job.equipment_detail1|default_if_none:''}}">
                                                        <input type="text" id="equipment_detail2{{forloop.counter}}" class="form-control" name="equipment_detail2" value="{{mtn_job.equipment_detail2|default_if_none:''}}">
                                                        <input type="text" id="equipment_detail3{{forloop.counter}}" class="form-control" name="equipment_detail3" value="{{mtn_job.equipment_detail3|default_if_none:''}}">
                                                    </div>
                                                    <div class="col-2">
                                                        <label>จำนวน</label>
                                                        <input type="text" id="equipment_quantity1{{forloop.counter}}" class="form-control" name="equipment_quantity1" value="{{mtn_job.equipment_quantity1|default_if_none:''}}">
                                                        <input type="text" id="equipment_quantity2{{forloop.counter}}" class="form-control" name="equipment_quantity2" value="{{mtn_job.equipment_quantity2|default_if_none:''}}">
                                                        <input type="text" id="equipment_quantity3{{forloop.counter}}" class="form-control" name="equipment_quantity3" value="{{mtn_job.equipment_quantity3|default_if_none:''}}">
                                                    </div>
                                                    <div class="col-3">
                                                        <label>หมายเหตุ</label>
                                                        <input type="text" id="equipment_note1{{forloop.counter}}" class="form-control" name="equipment_note1" value="{{mtn_job.equipment_note1|default_if_none:''}}">
                                                        <input type="text" id="equipment_note2{{forloop.counter}}" class="form-control" name="equipment_note2" value="{{mtn_job.equipment_note2|default_if_none:''}}">
                                                        <input type="text" id="equipment_note3{{forloop.counter}}" class="form-control" name="equipment_note3" value="{{mtn_job.equipment_note3|default_if_none:''}}">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="form-row">
                                                    <div class="col-4">
                                                        <label>ค่าใช้จ่ายโดยประมาณ</label>
                                                        <input type="number" class="form-control" id="estimate_cost" name="estimate_cost" value="{{mtn_job.estimate_cost|default_if_none:''}}">
                                                    </div>
                                                    <div class="col-8">
                                                        <label>หมายเหตุ</label>
                                                        <input type="text" class="form-control" id="job_remark" name="job_remark" value="{{mtn_job.job_remark|default_if_none:''}}">
                                                    </div>
                                                </div>
                                            </div>
                                            <hr><br>
                                            <center><h5><u><strong>ผลการดำเนินการ</strong></u></h5></center><br>
                                            <div class="form-group">
                                                <div class="form-row">
                                                    <div class="col-md-4">
                                                        <label class="control-label">Maintenance Type</label>
                                                        <select class="form-control" id="mtn_type{{forloop.counter}}" name="mtn_type">
                                                            {% if mtn_job.job_mtn_type != "repair" %}
                                                            <option value="change" {% if mtn_job.job_mtn_type == 'change' %}selected{% endif %}>Change</option>
                                                            <option value="checking" {% if mtn_job.job_mtn_type == 'checking' %}selected{% endif %}>Checking</option>
                                                            {% else  %}
                                                            <option value="repair" selected>Repair</option>
                                                            {% endif %}
                                                        </select>
                                                    </div>
                                                    <div class="col-md-8">
                                                        <label class="control-label">Maintenance Result</label>
                                                        <select class="form-control" id="mtn_result{{forloop.counter}}" name="mtn_result">
                                                            <option value="good">Good</option>
                                                            <option value="fair">Fair</option>
                                                            <option value="poor">Poor</option>
                                                            <option value="maintenance">Maintenance</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label>Maintenance Result Description</label>
                                                <input type="text" id="mtn_result_description{{forloop.counter}}" class="form-control" name="mtn_result_description" value="{{mtn_job.job_result_description|default_if_none:''}}">
                                            </div>
                                            <div class="form-group">
                                                <div class="form-row">
                                                    <div class="col-md-6">
                                                        <label>Machine Hour</label>
                                                        <input type="number" id="machine_hour_pv{{forloop.counter}}" class="form-control" name="machine_hour_pv" value="{{mtn_job.job_mch_sp.machine.machine_hour}}" readonly>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label>Machine Hour Manual</label>
                                                        <input type="number" id="machine_hour_sp{{forloop.counter}}" class="form-control" name="machine_hour_sp" placeholder="เปลี่ยนชั่วโมงเครื่องจักร">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="form-row">
                                                    <div class="col-md-6">
                                                        <label>Change Life Hour</label>
                                                        <input type="number" id="chang_life_hour_pv{{forloop.counter}}" class="form-control" name="chang_life_hour_pv" value="{{mtn_job.job_mch_sp.mtnchng_life_hour}}" readonly >
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label>Change Life Hour Manual</label>
                                                        <input type="number" id="chang_life_hour_sp{{forloop.counter}}" class="form-control" name="chang_life_hour_sp" placeholder="เปลี่ยนชั่วโมงการเปลี่ยนอะไหล่">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="form-row">
                                                    <div class="col-md-6">
                                                        <label>Check Life Hour</label>
                                                        <input type="number" id="check_life_hour_pv{{forloop.counter}}" class="form-control" name="check_life_hour_pv" value="{{mtn_job.job_mch_sp.mtnchk_life_hour}}" readonly >
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label>Check Life Hour Manual</label>
                                                        <input type="number" id="check_life_hour_sp{{forloop.counter}}" class="form-control" name="check_life_hour_sp" placeholder="เปลี่ยนชั่วโมงการตรวจสอบอะไหล่">
                                                    </div>
                                                </div>
                                            </div>
                                            <small>Assign By {{mtn_job.job_assign_user_id}} [ {{mtn_job.job_assign_date}} ]</small><br>
                                            <small>Response By {{mtn_job.job_response_user_id}} [ {{mtn_job.job_report_date}} ]</small><br>
                                            <small>Approve By {{mtn_job.job_assign_user_id}} [ {{mtn_job.job_approve_date}} ]</small>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-primary" name="report_submit" value="{{mtn_job.pk}}">Submit</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        {% endfor %}
                    </div>
                </div>
                <div class="col-lg-4 px-3">
                    <span class="h5">Completed</span>
                    <div class="scroll-area" data-spy="scroll" data-offset="0">
                        <!-- For loop maintenance requests -->
                        {% for mtn_job in maintenance_job_gen %}
                        {% if mtn_job.job_no|first in 'RP' and mtn_job.job_status == 'รอการอนุมัติงาน' %}
                        <div class="card">
                            <div class="card-hearder request-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-2"><b>{{mtn_job.job_no}}</b></h6>
                                    </div>
                                    <div class="text-right">
                                        <i class="fas fa-ellipsis-h" data-toggle="modal" data-target="#complete{{forloop.counter}}"></i>
                                    </div>
                            </div>
                            <div class="card-body request">
                                {% if mtn_job.repair_notice_set %}
                                {% for repair in mtn_job.repair_notice_set.all %}
                                <span class="badge request-badge">{{repair.repair_no}}</span>
                                {% endfor %}
                                {% endif %}
                                <p class="text-sm text-muted">{{mtn_job.job_mch_sp.spare_part}}</p>
                                <p class="text-sm text-muted">{{mtn_job.job_mch_sp.machine.machine_name}} {{mtn_job.job_mch_sp.machine.line}}</p>
                                <span class="card-details">
                                    <i class="fas fa-wrench"></i>&nbsp;ENGINEER : {{mtn_job.job_response_user_id}}<br>
                                    <i class="far fa-clock"></i> FINISHED : {{mtn_job.job_report_date}}
                                </span>
                            </div>
                        </div>
                        {% elif mtn_job.job_status == 'รอการอนุมัติงาน' %}
                        <div class="card">
                            <div class="card-hearder request-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-2"><b>{{mtn_job.job_no}}</b></h6>
                                    </div>
                                    <div class="text-right">
                                        <i class="fas fa-ellipsis-h" data-toggle="modal" data-target="#complete{{forloop.counter}}"></i>
                                    </div>
                            </div>
                            <div class="card-body">
                                <p class="text-sm text-muted">{{mtn_job.job_mch_sp.spare_part}}</p>
                                <p class="text-sm text-muted">{{mtn_job.job_mch_sp.machine.machine_name}} {{mtn_job.job_mch_sp.machine.line}}</p>
                                <span class="card-details">
                                    <i class="fas fa-wrench"></i>&nbsp;ENGINEER : {{mtn_job.job_response_user_id}}<br>
                                    <i class="far fa-clock"></i> FINISHED : {{mtn_job.job_report_date}}
                                </span>
                            </div>
                        </div>
                        {% endif %}
                        <!-- Modal Completed Jobs  -->
                        <div id="complete{{forloop.counter}}" class="modal fade" tabindex="-1">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <form method="POST">
                                        {% csrf_token %}
                                        <div class="modal-header">
                                            <h5 class="modal-title">รายงานระบบซ่อมบำรุง</h5>
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        </div>
                                        <div class="modal-body">
                                            <label><u><strong>ข้อมูลงาน</strong></u></label><br>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label class="control-label">หมายเลขงาน : {{mtn_job.job_no}}</label><br>
                                                    <label class="control-label">ผู้มอบหมายงาน : {{mtn_job.job_assign_user_id}}</label><br>
                                                    <label class="control-label">ผู้รับผิดชอบงาน : {{mtn_job.job_response_user_id}}</label><br>
                                                    <label class="control-label">สถานะงาน : <u>{{mtn_job.job_status}}</u></label><br>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="control-label">วันที่สร้างงาน : {{mtn_job.job_gen_date}}</label><br>
                                                    <label class="control-label">วันที่มอบหมายงาน : {{mtn_job.job_assign_date}}</label><br>
                                                    <label class="control-label">วันที่รายงานผลของงาน : {{mtn_job.job_report_date|default_if_none:''}}</label><br>
                                                    <label class="control-label">วันที่อนุมัติงาน : {{mtn_job.job_approve_date|default_if_none:''}}</label><br>
                                                </div>
                                            </div>
                                            <hr>
                                            <label><u><strong>เครื่องจักรและอะไหล่ที่บำรุงรักษา</strong></u></label><br>
                                            <label class="control-label">Production Line : {{mtn_job.job_mch_sp.machine.line.production_line}}</label><br>
                                            <label class="control-label">Machine : {{mtn_job.job_mch_sp.machine.machine_production_line_code}} | {{mtn_job.job_mch_sp.machine.machine_name}}</label><br>
                                            <label class="control-label">Spare Part : {{mtn_job.job_mch_sp.spare_part.spare_part_group}} | {{mtn_job.job_mch_sp.spare_part}}</label><br>
                                            <hr>
                                            <label><u><strong>ข้อมูลงานและปัญหา</strong></u></label><br>
                                            <label class="control-label">สาเหตุขัดข้องของเครื่อง : {{mtn_job.problem_cause}}</label><br>
                                            <label class="control-label">วิธีดำเนินการแก้ไข : {{mtn_job.corrective_action}}</label><br>
                                            <label class="control-label">วิธีการทำความสะอาดหลังการซ่อม : {{mtn_job.after_repair}}</label><br>
                                            <hr>
                                            <label><u><strong>รายการอุปกรณ์ / ชิ้นส่วนในการซ่อม</strong></u></label><br>
                                            {% if not mtn_job.equipment_code1 and not mtn_job.equipment_code2 and not mtn_job.equipment_code3 %}
                                            <label class="control-label">ไม่มีอุปกรณ์ที่ใช้</label><br>
                                            <label class="control-label">ค่าใช้จ่ายโดยประมาณ : <u>ไม่มี</u></label>
                                            {% else %}
                                            {% if mtn_job.equipment_code1 %} <label class="control-label">1. รหัสอุปกรณ์ {{mtn_job.equipment_code1}}   {{mtn_job.equipment_detail1}} จำนวน {{mtn_job.equipment_quantity1}} {% if tmn_job.equipment_note1 %} หมายเหตุ {{tmn_job.equipment_note1}} {% endif %}</label><br> {% endif %}
                                            {% if mtn_job.equipment_code2 %} <label class="control-label">2. รหัสอุปกรณ์ {{mtn_job.equipment_code2}}   {{mtn_job.equipment_detail2}} จำนวน {{mtn_job.equipment_quantity2}} {% if tmn_job.equipment_note2 %} หมายเหตุ {{tmn_job.equipment_note2}} {% endif %}</label><br> {% endif %}
                                            {% if mtn_job.equipment_code3 %} <label class="control-label">3. รหัสอุปกรณ์ {{mtn_job.equipment_code3}}   {{mtn_job.equipment_detail3}} จำนวน {{mtn_job.equipment_quantity3}} {% if tmn_job.equipment_note3 %} หมายเหตุ {{tmn_job.equipment_note3}} {% endif %}</label><br> {% endif %}
                                            <label class="control-label">ค่าใช้จ่ายโดยประมาณ : <u>{{mtn_job.estimate_cost|default_if_none:'ไม่เสียค่าใช้จ่าย'}}</u> {% if mtn_job.estimate_cost %}บาท{% endif %}</label><br>
                                            <label class="control-label">หมายเหตุ : {{mtn_job.job_remark}}</label>
                                            {% endif %}
                                            <hr>
                                            <label><u><strong>ข้อมูลการซ่อมบำรุงรักษา</strong></u></label><br>
                                            <label class="control-label">ชนิดการซ่อมบำรุงรักษา : {{mtn_job.job_mtn_type|default_if_none:''}}</label><br>
                                            <label class="control-label">ผลการซ่อมบำรุง/ตรวจสอบ : {{mtn_job.job_result_type|default_if_none:''}}</label><br>
                                            <label class="control-label">รายละเอียดเพิ่มเติม : {{mtn_job.job_result_description|default_if_none:''}}</label><br>
                                            <label class="control-label">ชั่วโมงเครื่องจักรที่บันทึกผล : {{mtn_job.job_mch_hour|default_if_none:''}}</label><br>
                                            <label class="control-label">อายุการใช้การเปลี่ยนของอะไหล่ที่บันทึกผล : {{mtn_job.job_fix_plan_hour|default_if_none:''}}</label><br>
                                            <label class="control-label">อายุการใช้การตรวจสอบของอะไหล่ที่บันทึกผล : {{mtn_job.job_plan_hour|default_if_none:''}}</label><br>
                                            <hr>
                                            <label><u><strong>การอนุมัติงาน</strong></u></label><br>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label class="control-label">การอนุมัติงานหรือไม่ : </label><br>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="onoffswitch">
                                                        <input type="checkbox" class="onoffswitch-checkbox" id="is_approve{{forloop.counter}}" name="is_approve" value="True" {% if mtn_job.is_approve %}checked{% endif %}>
                                                        <label class="onoffswitch-label" for="is_approve{{forloop.counter}}">
                                                            <span class="onoffswitch-inner"></span>
                                                            <span class="onoffswitch-switch"></span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-primary" name="approve_job" value="{{mtn_job.pk}}" {% if mtn_job.is_approve  %}disabled{% endif %}>Approve</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
<div class="machine-data-header">

    <div class="page-header row no-gutters py-4">
        <div class="col-12 col-sm-4 text-sm-left mb-0">
        <span class="text-uppercase page-subtitle">Overview</span>
        <h3 class="page-title">Production Line Data</h3>
        </div>
    </div>
</div>
<div class="machine-overview-content">
    <div class="row">
        <div class="col-md-12">
            {% for production_line in line_of_user %}
            <div class="col-lg-4 col-md-6 col-sm-6">
                <div class="card menu-card mb-4 text-center hover-bg-secondary">
                    <div class="card-body p-5">
                        <svg width="4em" height="4em" viewBox="0 0 16 16" class="bi bi-house text-color" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd" d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/>
                          <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/>
                        </svg>
                        <h4 class="card-title">{{production_line}}</h4>
                        <a href="{% url 'machine_data_line' production_line.pk %}" class="stretched-link"></a>
                    </div>
                </div>
            </div>
            {% endfor %}

        </div>
    </div>
</div>
<script src="{% static 'javascript/greeting.js' %}" type="text/javascript"></script>
<!-- Function assign job to engineer -->
<script>
    // Requested maintenance
    function load_selected_engineer(element) {
            var username = $(element).val();
            var num_loop = element.id.substr(13);

            var engineer_username = document.getElementById('engineer_user'+num_loop);
            var engineer_name = document.getElementById('engineer_name'+num_loop);
            var set_engineer = document.getElementById('set_engineer'+num_loop);
            engineer_username.value = username;
            engineer_name.value = username;
            $('.selectpicker').selectpicker('refresh');

            $.ajax({
                url : $(element).attr("data-url"),
                data : {
                    "csrfmiddlewaretoken" : $(element).siblings("input[name='csrfmiddlewaretoken']" ).val(),
                    "username" : username,

                },
                method: "POST",
                dataType : "json",
                success : function (data) {
                    if (data.user_success) {
                        set_engineer.value = data.user_username+" - "+data.user_firstname+" "+data.user_lastname;
                    }
                }
            });
    }
    // Round maintenance
    function load_selected_engineer_round(element) {
            var round_engineer = $(element).val();
            var num_loop = element.id.substr(19);
            //console.log(round_engineer);
            //console.log(num_loop);
            var engineer_username = document.getElementById('round_engineer_user'+num_loop);
            var engineer_name = document.getElementById('round_engineer_name'+num_loop);
            var set_engineer = document.getElementById('set_round_engineer'+num_loop);
            engineer_username.value = round_engineer;
            engineer_name.value = round_engineer;
            $('.selectpicker').selectpicker('refresh');

            $.ajax({
                url : $(element).attr("data-url"),
                data : {
                    "csrfmiddlewaretoken" : $(element).siblings("input[name='csrfmiddlewaretoken']" ).val(),
                    "round_engineer" : round_engineer,

                },
                method: "POST",
                dataType : "json",
                success : function (data) {
                    if (data.round_success) {
                        set_engineer.value = data.round_username+" - "+data.round_firstname+" "+data.round_lastname;
                    }
                }
            });
    }
</script>
{% endblock %}
