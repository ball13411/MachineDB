<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Machine Management</title>

    {% load static %}
    <!-- icon -->
    <link rel="stylesheet" type="text/css" href="{% static 'iconfont/material-icons.css' %}">
    <script src="{% static 'javascript/fontawesom_icon_msn.js' %}"></script>
    <!-- Fonts -->
    <link rel="stylesheet" type="text/css" href="{% static 'fonts/fonts.css' %}">
    <!-- Jquery   -->
    <script src="{% static 'javascript/jquery-3.5.1.min.js' %}"></script>
    <!-- Bootstrap 4.5.3 -->
    <link rel="stylesheet" type="text/css" href="{% static 'style/bootstrap.min.css' %}">
    <script src="{% static 'javascript/bootstrap.min.js' %}"></script>
    <!-- DataTable   -->
    <link rel="stylesheet" type="text/css" href="{% static 'style/jquery.dataTables-1.10.19.min.css' %}">
    <script src="{% static 'javascript/jquery.dataTables.min.js' %}"></script>
    <!--  Popper  -->
    <script src="{% static 'javascript/popper-1.16.0.min.js' %}"></script>
    <!-- Moment   -->
    <script src="{% static 'javascript/moment-2.29.0.min.js' %}"></script>
    <!--  Input Date Format  DD/MM/YYYY -->
    <link rel="stylesheet" type="text/css" href="{% static 'style/input_date.css' %}">
    <!--  Container Form -->
    <link rel="stylesheet" type="text/css" href="{% static 'style/container-fluid.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'style/form-group.css' %}">

    <script>
        $(document).ready(function(){
            $("#setting").on("show.bs.modal", function(event){
                // Get the button that triggered the modal
                var button = $(event.relatedTarget);

                // Extract value from the custom data-* attribute
                var titleData = button.data("title");
                $(this).find(".modal-title").text(titleData);
            });
        });
    </script>
    <script>
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });
    </script>
</head>
<body>

<div class="container-fluid">
    <nav class="navbar navbar-expand-md navbar-light" style="background-color: #f5f5f5;">
        <a href="{% url 'home' %}" class="navbar-brand">
            <img src="/static/img/farmhouse_logo copy.gif" height="65" alt="CoolBrand">
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
            <div class="navbar-nav">
                <a href="{% url 'maintenance_data' %}" class="nav-item nav-link">Maintenance Data</a>
                <a href="{% url 'repair_notice' %}" class="nav-item nav-link active"><b>Repair Notice</b></a>
                <a href="{% url 'maintenance_job' %}" class="nav-item nav-link ">Maintenance Assign</a>
                <a href="{% url 'maintenance_report' %}" class="nav-item nav-link">Maintenance Report</a>
                <a href="{% url 'machine_hour_update' %}" class="nav-item nav-link">Machine Hour Update</a>
            </div>
            <form method="POST" action="{% url 'signin' %}">
                {% csrf_token %}
                <ul class="nav navbar-nav ml-auto">
                    <a href="#" class="nav-item nav-link" style="color:#B22222">{{User_login.username}}</a>
                    <button type="submit" class="btn btn-outline-secondary" name="signout" >Sign out</button>
                </ul>
            </form>
        </div>
    </nav>
</div>
<div class="container-fluid">
    <div class="table-responsive">
        {% for message in messages %}
        <div class="alert {{ message.tags }} alert-dismissible" role="alert">
            <span class="closebtn" onclick="this.parentElement.style.display='none';" style="color: #454545; font-size: 36px;">&times;</span>
            {{ message }}
        </div>
        {% endfor %}
        <div class="table-wrapper">
            <form method="POST">
            <div class="table-title">
                <div class="row">
                    <div class="col-sm-8">
                        <h2>Repair <b>Notice</b></h2>
                    </div>
                    <div class="col-sm-4">
                        <a href="#create_repair_notice" class="btn btn-secondary" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>แจ้งซ่อมเครื่องจักร</span></a>
                    </div>
                </div>
            </div>
            <table class="table table-striped table-hover" id="myTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>หมายเลขใบแจ้งซ่อม</th>
                        <th>หน่วยงานที่แจ้ง</th>
                        <th>ไลน์ผลิต</th>
                        <th>เครื่องจักร</th>
                        <th>วันที่แจ้ง</th>
                        <th>วันที่ต้องการใช้</th>
                        <th>สถานะการแจ้ง</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
            {% for repair in list_repair_notice %}
                    <tr>
                        <td>{{forloop.counter}}</td>
                        <td>{{repair.repair_no}}</td>
                        <td>{{repair.agency_notifying}}</td>
                        <td>{{repair.machine.line}}</td>
                        <td>{{repair.machine.machine_name}}</td>
                        <td>{{repair.notification_date}}</td>
                        <td>{{repair.use_date}}</td>
                        <td>{{repair.repair_status}}</td>
                        <td><a href="#setting{{forloop.counter}}" class="settings" title="Settings" data-toggle="modal"><i class="material-icons">&#xE8B8;</i></a></td>
                    </tr>

            <!-- Modal job -->
            <div id="setting{{forloop.counter}}" class="modal fade" tabindex="-1">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <form method="POST">
                            {% csrf_token %}
                            <div class="modal-header">
                                <h5 class="modal-title">Repair Form</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <label><u><strong>ใบแจ้งซ่อมเครื่องจักร</strong></u></label><br>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="control-label">หมายเลขใบแจ้งซ่อม : {{repair.repair_no}}</label>
                                        </div>
                                        <div class="col-md-6" align="right">
                                            <label class="control-label">วันที่แจ้งซ่อม : {{repair.notification_date}}</label>
                                        </div>
                                    </div>

                                <label class="control-label">หน่วยงานทีแจ้ง : {{repair.agency_notifying}}</label><br>
                                <label class="control-label">พนักงานที่แจ้ง : {{repair.repairer_user}}  &nbsp;&nbsp;&nbsp;ติดต่อ : {{repair.repairer_contact}}</label><br>
                                <label class="control-label"><u>เครื่องจักร : {{repair.machine.machine_production_line_code}} | {{repair.machine.machine_name}}</u>&nbsp;&nbsp;&nbsp; [ {{repair.machine.line}} ]</label><br>
                                <label class="control-label">ปัญหาเครื่องจักรที่พบ : {{repair.problem_report}}</label><br>
                                <label class="control-label">ผลกระทบของปัญหา : {{repair.effect_problem}}</label><br>
                                <label class="control-label">วันที่ต้องการใช้งาน : {{repair.use_date}}</label><br>
                                <hr>
                                <label><u><strong>อุปกรณ์หรือชิ้นส่วนที่ชำรุด</strong></u></label><br>
                                <div class="form-group">
                                    <div class="form-row">
                                        <div class="col-1">
                                            <label>ลำดับที่</label><br>
                                            <label class="col-12 col-form-label" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>1</label>
                                            <label class="col-12 col-form-label" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>2</label>
                                            <label class="col-12 col-form-label" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>3</label>
                                            <label class="col-12 col-form-label" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>4</label>
                                            <label class="col-12 col-form-label" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>5</label>
                                        </div>
                                        <div class="col-3">
                                            <label>กลุ่มอะไหล่</label>
                                            <select class="form-control" id="select_sp_group1_{{forloop.counter}}" name="select_sp_group" onchange="ajax_dropdown_type(this)" data-url="{% url 'ajax_dropdown_sp_type' %}" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกกลุ่มอะไหล่</option>
                                                {% for sp_group in spare_part_group_all %}
                                                <option value="{{sp_group.pk}}" {% if repair.spare_part_1.spare_part_group_id == sp_group.pk %}selected{% endif %}>{{sp_group.spare_part_group_code}} | {{sp_group.spare_part_group_name}}</option>
                                                {% endfor %}
                                            </select>
                                            <select class="form-control" id="select_sp_group2_{{forloop.counter}}" name="select_sp_group" onchange="ajax_dropdown_type(this)" data-url="{% url 'ajax_dropdown_sp_type' %}" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกกลุ่มอะไหล่</option>
                                                {% for sp_group in spare_part_group_all %}
                                                <option value="{{sp_group.pk}}" {% if repair.spare_part_2.spare_part_group_id == sp_group.pk %}selected{% endif %}>{{sp_group.spare_part_group_code}} | {{sp_group.spare_part_group_name}}</option>
                                                {% endfor %}
                                            </select>
                                            <select class="form-control" id="select_sp_group3_{{forloop.counter}}" name="select_sp_group" onchange="ajax_dropdown_type(this)" data-url="{% url 'ajax_dropdown_sp_type' %}" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกกลุ่มอะไหล่</option>
                                                {% for sp_group in spare_part_group_all %}
                                                <option value="{{sp_group.pk}}" {% if repair.spare_part_3.spare_part_group_id == sp_group.pk %}selected{% endif %}>{{sp_group.spare_part_group_code}} | {{sp_group.spare_part_group_name}}</option>
                                                {% endfor %}
                                            </select>
                                            <select class="form-control" id="select_sp_group4_{{forloop.counter}}" name="select_sp_group" onchange="ajax_dropdown_type(this)" data-url="{% url 'ajax_dropdown_sp_type' %}" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกกลุ่มอะไหล่</option>
                                                {% for sp_group in spare_part_group_all %}
                                                <option value="{{sp_group.pk}}" {% if repair.spare_part_4.spare_part_group_id == sp_group.pk %}selected{% endif %}>{{sp_group.spare_part_group_code}} | {{sp_group.spare_part_group_name}}</option>
                                                {% endfor %}
                                            </select>
                                            <select class="form-control" id="select_sp_group5_{{forloop.counter}}" name="select_sp_group" onchange="ajax_dropdown_type(this)" data-url="{% url 'ajax_dropdown_sp_type' %}" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกกลุ่มอะไหล่</option>
                                                {% for sp_group in spare_part_group_all %}
                                                <option value="{{sp_group.pk}}" {% if repair.spare_part_5.spare_part_group_id == sp_group.pk %}selected{% endif %}>{{sp_group.spare_part_group_code}} | {{sp_group.spare_part_group_name}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="col-3">
                                            <label>ประเภทอะไหล่</label>
                                            <select class="form-control" id="select_sp_type1_{{forloop.counter}}" name="select_sp_type" required="True" onchange="ajax_dropdown_subtype(this)" data-url="{% url 'ajax_dropdown_sp_subtype' %}" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกประเภทอะไหล่</option>
                                                {% if repair.spare_part_1_id %}
                                                <option value="{{repair.spare_part_1.spare_part_type_id}}" selected>{{repair.spare_part_1.spare_part_type.spare_part_type_code}} | {{repair.spare_part_1.spare_part_type.spare_part_type_name}}</option>
                                                {% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_type2_{{forloop.counter}}" name="select_sp_type" required="True" onchange="ajax_dropdown_subtype(this)" data-url="{% url 'ajax_dropdown_sp_subtype' %}" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกประเภทอะไหล่</option>
                                                {% if repair.spare_part_2_id %}
                                                <option value="{{repair.spare_part_2.spare_part_type_id}}" selected>{{repair.spare_part_2.spare_part_type.spare_part_type_code}} | {{repair.spare_part_2.spare_part_type.spare_part_type_name}}</option>
                                                {% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_type3_{{forloop.counter}}" name="select_sp_type" required="True" onchange="ajax_dropdown_subtype(this)" data-url="{% url 'ajax_dropdown_sp_subtype' %}" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกประเภทอะไหล่</option>
                                                {% if repair.spare_part_3_id %}
                                                <option value="{{repair.spare_part_3.spare_part_type_id}}" selected>{{repair.spare_part_3.spare_part_type.spare_part_type_code}} | {{repair.spare_part_3.spare_part_type.spare_part_type_name}}</option>
                                                {% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_type4_{{forloop.counter}}" name="select_sp_type" required="True" onchange="ajax_dropdown_subtype(this)" data-url="{% url 'ajax_dropdown_sp_subtype' %}" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกประเภทอะไหล่</option>
                                                {% if repair.spare_part_4_id %}
                                                <option value="{{repair.spare_part_4.spare_part_type_id}}" selected>{{repair.spare_part_4.spare_part_type.spare_part_type_code}} | {{repair.spare_part_4.spare_part_type.spare_part_type_name}}</option>
                                                {% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_type5_{{forloop.counter}}" name="select_sp_type" required="True" onchange="ajax_dropdown_subtype(this)" data-url="{% url 'ajax_dropdown_sp_subtype' %}" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกประเภทอะไหล่</option>
                                                {% if repair.spare_part_5_id %}
                                                <option value="{{repair.spare_part_5.spare_part_type_id}}" selected>{{repair.spare_part_5.spare_part_type.spare_part_type_code}} | {{repair.spare_part_5.spare_part_type.spare_part_type_name}}</option>
                                                {% endif %}
                                            </select>

                                        </div>
                                        <div class="col-3">
                                            <label>ชนิดอะไหล่</label>
                                            <select class="form-control" id="select_sp_subtype1_{{forloop.counter}}" name="select_sp_subtype" required="True" onchange="ajax_dropdown_sp(this)" data-url="{% url 'ajax_dropdown_sp' %}" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกชนิดอะไหล่</option>
                                                {% if repair.spare_part_1_id %}
                                                <option value="{{repair.spare_part_1.spare_part_type_id}}" selected>{{repair.spare_part_1.spare_part_sub_type.spare_part_sub_type_code}} | {{repair.spare_part_1.spare_part_sub_type.spare_part_sub_type_name}}</option>
                                                {% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_subtype2_{{forloop.counter}}" name="select_sp_subtype" required="True" onchange="ajax_dropdown_sp(this)" data-url="{% url 'ajax_dropdown_sp' %}" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกชนิดอะไหล่</option>
                                                {% if repair.spare_part_2_id %}
                                                <option value="{{repair.spare_part_2.spare_part_type_id}}" selected>{{repair.spare_part_2.spare_part_sub_type.spare_part_sub_type_code}} | {{repair.spare_part_2.spare_part_sub_type.spare_part_sub_type_name}}</option>
                                                {% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_subtype3_{{forloop.counter}}" name="select_sp_subtype" required="True" onchange="ajax_dropdown_sp(this)" data-url="{% url 'ajax_dropdown_sp' %}" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกชนิดอะไหล่</option>
                                                {% if repair.spare_part_3_id %}
                                                <option value="{{repair.spare_part_3.spare_part_type_id}}" selected>{{repair.spare_part_3.spare_part_sub_type.spare_part_sub_type_code}} | {{repair.spare_part_3.spare_part_sub_type.spare_part_sub_type_name}}</option>
                                                {% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_subtype4_{{forloop.counter}}" name="select_sp_subtype" required="True" onchange="ajax_dropdown_sp(this)" data-url="{% url 'ajax_dropdown_sp' %}" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกชนิดอะไหล่</option>
                                                {% if repair.spare_part_4_id %}
                                                <option value="{{repair.spare_part_4.spare_part_type_id}}" selected>{{repair.spare_part_4.spare_part_sub_type.spare_part_sub_type_code}} | {{repair.spare_part_4.spare_part_sub_type.spare_part_sub_type_name}}</option>
                                                {% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_subtype5_{{forloop.counter}}" name="select_sp_subtype" required="True" onchange="ajax_dropdown_sp(this)" data-url="{% url 'ajax_dropdown_sp' %}" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกชนิดอะไหล่</option>
                                                {% if repair.spare_part_5_id %}
                                                <option value="{{repair.spare_part_5.spare_part_type_id}}" selected>{{repair.spare_part_5.spare_part_sub_type.spare_part_sub_type_code}} | {{repair.spare_part_5.spare_part_sub_type.spare_part_sub_type_name}}</option>
                                                {% endif %}
                                            </select>
                                        </div>
                                        <div class="col-2">
                                            <label>อะไหล่</label>
                                            <select class="form-control" id="select_sp_name1_{{forloop.counter}}" name="select_sp_name1" required="True" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %} >
                                                <option value="0">เลือกอะไหล่</option>
                                                {% if repair.spare_part_1_id %}<option value="{{repair.spare_part_1_id}}" selected>{{repair.spare_part_1.spare_part_name}}</option>{% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_name2_{{forloop.counter}}" name="select_sp_name2" required="True" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกอะไหล่</option>
                                                {% if repair.spare_part_2_id %}<option value="{{repair.spare_part_2_id}}" selected>{{repair.spare_part_2.spare_part_name}}</option>{% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_name3_{{forloop.counter}}" name="select_sp_name3" required="True" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกอะไหล่</option>
                                                {% if repair.spare_part_3_id %}<option value="{{repair.spare_part_3_id}}" selected>{{repair.spare_part_3.spare_part_name}}</option>{% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_name4_{{forloop.counter}}" name="select_sp_name4" required="True" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกอะไหล่</option>
                                                {% if repair.spare_part_4_id %}<option value="{{repair.spare_part_4_id}}" selected>{{repair.spare_part_4.spare_part_name}}</option>{% endif %}
                                            </select>
                                            <select class="form-control" id="select_sp_name5_{{forloop.counter}}" name="select_sp_name5" required="True" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <option value="0">เลือกอะไหล่</option>
                                                {% if repair.spare_part_5_id %}<option value="{{repair.spare_part_5_id}}" selected>{{repair.spare_part_5.spare_part_name}}</option>{% endif %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div {% if repair.repair_status == "รอช่างมายืนยัน" %}hidden{% endif %}>
                                    <label><u><strong>งานระบบการซ่อมบำรุงรักษา</strong></u></label><br>
                                    <div class="form-group">
                                        <div class="form-row">
                                            <div class="col-1">
                                                <label>ลำดับที่</label><br>
                                                <label class="col-sm-12 col-form-label" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>1</label>
                                                <label class="col-sm-12 col-form-label" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>2</label>
                                                <label class="col-sm-12 col-form-label" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>3</label>
                                                <label class="col-sm-12 col-form-label" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>4</label>
                                                <label class="col-sm-12 col-form-label" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>5</label>
                                            </div>
                                            <div class="col-3">
                                                <label>หมายเลขงาน</label><br>
                                                <input class="form-control" type="text" value="{{repair.job1.job_no}}" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.job2.job_no}}" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.job3.job_no}}" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.job4.job_no}}" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.job5.job_no}}" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                            </div>
                                            <div class="col-3">
                                                <label>เครื่องจักร</label><br>
                                                <input class="form-control" type="text" value="{{repair.machine.machine_name}}" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.machine.machine_name}}" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.machine.machine_name}}" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.machine.machine_name}}" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.machine.machine_name}}" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                            </div>
                                            <div class="col-3">
                                                <label>อะไหล่หรือชิ้นส่วน</label><br>
                                                <input class="form-control" type="text" value="{{repair.spare_part_1.spare_part_name}}" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.spare_part_2.spare_part_name}}" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.spare_part_3.spare_part_name}}" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.spare_part_4.spare_part_name}}" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.spare_part_5.spare_part_name}}" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                            </div>
                                            <div class="col-2">
                                                <label>สถานะงาน</label><br>
                                                <input class="form-control" type="text" value="{{repair.job1.job_status}}" {% if repair.spare_part_1_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.job2.job_status}}" {% if repair.spare_part_2_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.job3.job_status}}" {% if repair.spare_part_3_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.job4.job_status}}" {% if repair.spare_part_4_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                                <input class="form-control" type="text" value="{{repair.job5.job_status}}" {% if repair.spare_part_5_id %}disabled{% else %}{% if repair.repair_status != "รอช่างมายืนยัน" %}hidden{% endif %}{% endif %}>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary" name="repair_submit" value="{{repair.pk}}" {% if repair.repair_status == 'รอการดำเนินงาน' %}disabled{% endif %}>Submit</button>
                            </div>
                        </div>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
            <div id="create_repair_notice" class="modal fade" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <form method="POST">
                            {% csrf_token %}
                            <div class="modal-header">
                                <h5 class="modal-title">Repair Notice</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>

                            <div class="modal-body">
                                <div class="form-group">
                                    <div class="form-row">
                                        <div class="col-md-8">
                                            <label>หน่วยงานที่แจ้ง</label>
                                            <input type="text" class="form-control" name="agency_notifying" id="agency_notifying" required="True" autocomplete="off" maxlength="20"/>
                                        </div>
                                        <div class="col-md-4">
                                            <label>วันที่ต้องการใช้งาน</label>
                                            <input type="date" id="use_date" class="form-control" name="use_date" required="True" >
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <label>ผู้แจ้งการซ่อมเครื่องจักร</label>
                                            <input type="text" class="form-control" name="repairer_user" id="repairer_user" required="True" autocomplete="off" maxlength="30"/>
                                        </div>
                                        <div class="col-md-4">
                                            <label>เบอร์ติดต่อหรือการติดต่อ</label>
                                            <input type="text" class="form-control" name="repairer_contact" id="repairer_contact" required="True" autocomplete="off"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="col-md-4">
                                        <label class="control-label">Line</label>
                                        <select  class="form-control" id="production_line" name="production_line" onchange="select_machine(this)" required="True">
                                            <option value="">--- กรุณาเลือกไลน์การผลิต ---</option>
                                            {% for line in line_of_user %}
                                            <option value="{{line.pk}}">{{line.location_site}} ไลน์ผลิต {{line.production_line}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-8">
                                        <label class="control-label">Last name</label>
                                        <select  class="form-control" id="machine" name="machine" required="True">
                                            <option value="">--- กรุณาเลือกเครื่องจักร ---</option>
                                        </select>
                                    </div>
                                </div>
                                <br>
                                <div class="form-group">
                                    <label for="add_email">ปัญหาเครื่องจักร</label>
                                    <textarea class="form-control" rows="2" name="problem_report"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="add_email">ผลกระทบของปัญหา</label>
                                    <textarea class="form-control" rows="2" name="effect_problem"></textarea>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary" name="create_repair" id="create_repair">Submit</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
                </tbody>
            </table>
            </form>

        </div>
    </div>
</div>
<script>
    $(document).ready( function () {
    $('#myTable').DataTable();
} );
</script>
<script src="{% static 'javascript/input_date.js'%}"></script>
<script>
    function select_machine(element) {
        var line_id = document.getElementById('production_line').value;
        $.ajax({
            url: "{% url 'ajax_load_machine' %}",
            data: {
                'line_id': line_id
            },
            success: function (data) {
                $("#machine").html(data);
            }
        });
    }
</script>
<script>
        function ajax_dropdown_type(element) {
            var filter_sp_type = $(element).val();
            var numID = element.id.substr(17);
            var indexID = element.id.substr(15,2);
            $.ajax({
                url : $(element).attr("data-url"),
                data : {
                    "csrfmiddlewaretoken" : $(element).siblings("input[name='csrfmiddlewaretoken']" ).val(),
                    "filter_sp_type" : filter_sp_type,

                },
                method: "POST",
                dataType : "json",
                success : function (data) {
                    if (data) {
                        $('#select_sp_type'+indexID+numID).empty();
                        var select_type = document.getElementById('select_sp_type'+indexID+numID);
                        var option_first = document.createElement('option');
                        option_first.appendChild(document.createTextNode("เลือกประเภทอะไหล่"));
                        option_first.value = 0;
                        select_type.appendChild(option_first);
                        for (model in data) {
                            var options = document.createElement('option');
                            var code = data[model].fields.spare_part_type_code;
                            var name = data[model].fields.spare_part_type_name;
                            options.appendChild(document.createTextNode(code+" | "+name));
                            options.value = data[model].pk;
                            select_type.appendChild(options);
                        }
                    } else {
                        $('#select_sp_type'+indexID+numID).empty();
                    }
                }
            });
        }
</script>
<script>
        function ajax_dropdown_subtype(element) {
            var filter_sp_subtype = $(element).val();
            var numID = element.id.substr(16);
            var indexID = element.id.substr(14,2);
            $.ajax({
                url : $(element).attr("data-url"),
                data : {
                    "csrfmiddlewaretoken" : $(element).siblings("input[name='csrfmiddlewaretoken']" ).val(),
                    "filter_sp_subtype" : filter_sp_subtype,

                },
                method: "POST",
                dataType : "json",
                success : function (data) {
                    if (data) {
                        $('#select_sp_subtype'+indexID+numID).empty();
                        var select_subtype = document.getElementById('select_sp_subtype'+indexID+numID);
                        var option_first_subtype = document.createElement('option');
                        option_first_subtype.appendChild(document.createTextNode("เลือกชนิดอะไหล่"));
                        option_first_subtype.value = 0;
                        select_subtype.appendChild(option_first_subtype);
                        for (model in data) {
                            var options = document.createElement('option');
                            var code = data[model].fields.spare_part_sub_type_code;
                            var name = data[model].fields.spare_part_sub_type_name;
                            options.appendChild(document.createTextNode(code+" | "+name));
                            options.value = data[model].pk;
                            select_subtype.appendChild(options);
                        }
                    } else {
                        $('#select_sp_subtype'+indexID+numID).empty();
                    }
                }
            });
        }
</script>
<script>
        function ajax_dropdown_sp(element) {
            var filter_sp = $(element).val();
            var numID = element.id.substr(19);
            var indexID = element.id.substr(17,2);
            $.ajax({
                url : $(element).attr("data-url"),
                data : {
                    "csrfmiddlewaretoken" : $(element).siblings("input[name='csrfmiddlewaretoken']" ).val(),
                    "filter_sp" : filter_sp,

                },
                method: "POST",
                dataType : "json",
                success : function (data) {
                    if (data) {
                        $('#select_sp_name'+indexID+numID).empty();
                        var select_sp = document.getElementById('select_sp_name'+indexID+numID);
                        var option_first_subtype = document.createElement('option');
                        option_first_subtype.appendChild(document.createTextNode("เลือกชนิดอะไหล่"));
                        option_first_subtype.value = 0;
                        select_sp.appendChild(option_first_subtype);
                        for (model in data) {
                            var options = document.createElement('option');
                            var name = data[model].fields.spare_part_name;
                            options.appendChild(document.createTextNode(name));
                            options.value = data[model].pk;
                            select_sp.appendChild(options);
                        }
                    } else {
                        $('#select_sp_subtype'+indexID+numID).empty();
                    }
                }
            });
        }
</script>

</body>
</html>
